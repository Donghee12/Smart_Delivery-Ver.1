v# Smart_Delivery-Ver.1 프로젝트

본 프로젝트는 아두이노 기반의 지능형 물류 및 자동 분류 시스템으로, 현대 물류 시스템의 효율성과 정확성 문제를 해결하기 위해 개발되었습니다. 첨단 센서, 실시간 영상 처리(YOLO 객체 검출), 데이터베이스 관리, 직관적인 UI를 통합하여 제품 입고부터 분류, 데이터 추적까지 자동화합니다. 특히, 제품 손상 감지와 자동 경로 설정을 통해 물류 오류를 최소화하고 생산성을 극대화하는 것을 목표로 합니다.

---

## 🚀 주요 기능

### 1. 모터 제어 (Arduino)

- **컨베이어 벨트 제어**  
  - `ar_motor_control.cpp`에 정의된 함수로 컨베이어 벨트의 시작 및 정지 동작을 수행.  
  - 시스템 흐름 제어의 핵심.

- **서보 모터 기반 분류**  
  - 3개의 서보 모터(`ar_servo_1`, `ar_servo_2`, `ar_servo_3`)를 통해 제품을 지정된 분류 구역(평택, 천안, 제주)으로 이동시킴.  
  - `ar_controlServo()` 함수로 각도를 정밀 제어하여 분류 정확도 보장.  
  - 분류 명령은 PC로부터 수신된 명령에 따라 동적으로 변경.

  | 명령 | 설명                  |
  |-------|-----------------------|
  | 'P'   | 평택 구역으로 유도     |
  | 'C'   | 천안 구역으로 유도     |
  | 'J'   | 제주 구역으로 유도     |
  | 'E'   | 서보 모터 초기화 및 다음 이동 준비 |

- **초음파 센서 감지**  
  - HC-SR04 센서를 사용하여 컨베이어 벨트 위 물체 유무 및 거리 감지.  
  - 특정 거리 내 물체 감지 시 벨트를 자동 정지시켜 안정적인 제품 처리 지원.

- **관련 파일**  
  - `ar_motor_control.cpp`, `ar_motor_control.h`, `ar_t_testcode.ino`

---

### 2. 시리얼 통신

- 아두이노와 PC 간 안정적인 양방향 통신 구현.
- `ar_Serial.cpp`에 구현된 `ar_Serial` 클래스를 통해 명령 및 데이터 교환.
- PC는 'P', 'C', 'J', 'E' 등의 명령어를 아두이노에 전송해 분류 및 벨트 제어.
- 아두이노는 센서 데이터와 상태 정보를 PC로 송신해 피드백 루프 완성.

- **관련 파일**  
  - `ar_Code.cpp`, `ar_Serial.cpp`

---

### 3. 데이터베이스 관리 (MySQL)

- 고객 및 주문 정보의 체계적 저장과 관리.
- `database.cpp`, `database_config.cpp` 통해 MySQL DB(test_db 스키마) 연결 및 관리.
- 주요 함수:  
  - `db_insertCustomerData()`: 고객 등록 및 업데이트  
  - `db_insertProductData()`: 주문 내역 저장  
  - `db_getOrderDetails()`: 주문 상세 조회  
- 제품 가격은 `db_user_info.cpp` 내 `getProductPrice()` 함수에서 자동 연동.
- ID 조회 함수로 데이터 연동 정확성 보장.

- **관련 파일**  
  - `database_config.cpp`, `database.cpp`, `db_user_info.cpp`

---

### 4. QR 코드 생성 및 스캔

- 제품 정보 디지털화 및 자동 인식.
- QR 코드 생성: `im_qrcode.cpp`, `qrcodegen.cpp` 사용, QR 코드를 이미지(`cv::Mat`)로 생성 후 .jpg 저장.
- QR 코드 스캔: `scanQRCode.cpp` 모듈에서 OpenCV `QRCodeDetector` 활용, 영상 전처리(샤프닝) 적용.
- 디코딩된 주문 번호를 DB 조회에 활용해 주문 정보 연동.

- **관련 파일**  
  - `qrcodegen.cpp`, `scanQRCode.cpp`, `im_qrcode.cpp`

---

### 5. 메인 애플리케이션 로직 (PC)

- 실시간 영상 캡처 및 분석을 통한 시스템 흐름 제어.
- `main.cpp`에서 웹캠 영상 캡처 및 YOLO 객체 검출 수행.
- `detection.h`의 `Inference` 클래스로 YOLO 모델(best.onnx) 적용.
- 손상 감지 시 ‘E’(Error/Eject) 명령 시리얼 전송해 불량품 분류 유도.
- QR 코드 감지 시 주문 상세 정보 조회 및 분류 결정.

- **관련 파일**  
  - `main.cpp`  
  - YOLO 모델 파일(.onnx, .txt)

---

### 6. MFC 사용자 인터페이스 (GUI)

- 사용자 편의를 위한 직관적 GUI 제공.
- `MFC_TESTDlg.cpp`에서 고객 및 주문 정보 입력 폼 구현.
- 입력 데이터는 DB에 저장되고, QR 코드 자동 생성 및 이미지 저장.
- 입력 필드 초기화 등의 편의 기능 포함.

- **관련 파일**  
  - `MFC_TEST.cpp`, `MFC_TESTDlg.cpp`, `pch.cpp` (사전 컴파일 헤더)

---

# 프로젝트 구성 파일 및 역할

| 구성 파일                   | 역할 및 설명                                   |
|-----------------------------|-----------------------------------------------|
| `ar_motor_control.txt`       | 모터 및 컨베이어 벨트 제어 함수 구현          |
| `ar_Serial.cpp`          | 아두이노-PC 시리얼 통신 구현 클래스            |
| `database.cpp`           | 데이터베이스 연결 및 데이터 조작 함수          |
| `im_qrcode.cpp`          | QR 코드 생성 기능 구현                         |
| `scanQRCode.cpp`         | QR 코드 스캔 및 디코딩                         |
| `main.cpp`               | 메인 애플리케이션 로직                         |
| `MFC_TESTDlg.cpp`        | MFC GUI 대화 상자 구현                         |
| `db_user_info.cpp`       | 제품 가격 조회 및 관련 유틸리티 함수            |

---

## 참고

- 각 모듈은 연동되어 물류 프로세스를 자동화하며, 센서 및 영상 데이터를 기반으로 실시간으로 제품을 분류 및 추적합니다.  
- 시스템은 사용자 친화적인 GUI와 안정적인 통신 프로토콜을 통해 효율적인 운영이 가능하도록 설계되었습니다.
